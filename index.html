<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>

<body>
    <script>
        var list = [];
        var cellsCount;
        var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            scene: {
                preload: preload,
                create: create
            }
        };

        var game = new Phaser.Game(config);

        function preload() {
            this.load.spritesheet('brick', 'public/assets/brick.png', { frameWidth: 200, frameHeight: 200 });
            this.load.image('bg', 'public/assets/bg.jpg');
        }

        function create() {
            this.add.image(400, 300, 'bg');

            // Fill the board with bricks
            generate_bricks(this, 100, 6, 8);

            //Generate bombs within bricks
            generate_bombs(20, 100);

        }

        function generate_bricks(brick, n, rows, cols) {
            cellsCount = rows * cols;
            for (var i = 1; i <= rows; i++) {
                for (var j = 1; j <= cols; j++) {
                    var l = brick.add.image((n * j) - n, (i * n) - n, 'brick').setOrigin(0, 0);
                    l.row = i;
                    l.col = j;
                    l.hasBomb = false;
                    l.on('pointerdown', function () {
                        // this.setVisible(false);
                        console.log(this.row + ", " + this.col);
                        console.log(this.hasBomb);
                    });
                    l.setInteractive();
                    list.push(l);
                }
            }
        }

        function generate_bombs(maxBombs, tries) {
            var bombCount = 0;
            var max_loops = 0;
            while (bombCount < maxBombs && max_loops < tries) {
                for (var i = 0; i < list.length; i++) {
                    var rand = Math.floor(Math.random() * cellsCount);
                    if (rand == 1) {
                        list[i].hasBomb = true;
                        list[i].setTint(0xff0000);
                        bombCount++;
                        if (bombCount >= maxBombs) {
                            break;
                        }
                    }
                }
                max_loops++;
            }
        }
    </script>

</body>

</html>